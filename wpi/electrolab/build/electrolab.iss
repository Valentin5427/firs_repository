; Script generated by the Inno Setup Script Wizard.
; SEE THE DOCUMENTATION FOR DETAILS ON CREATING INNO SETUP SCRIPT FILES!

#define AppName "Electrolab"
#define AppPublisher "Diposoft"
#define AppURL "http://diposoft.ru/ElectroLab.html"
#define UpdateURL "http://diposoft.ru/ElectroLab/install/"

;#define workpath "C:\work\ElectroLab\trunk\electrolab"
#define MajorVersion "2"
#define MinorVersion "2"
;#define BuildNumber "0"

#define VerificationExeName "wpt.exe"
#define VerificationName "Verification"

#define ManagerExeName "wpm.exe"
#define ManagerName "Manager"

#define InfoExeName "wpi.exe"
#define InfoName "Info"

#define IntegrationExeName "integration.exe"
#define IntegrationName "Integration"

#define Export1cExeName "Export1c.exe"
#define Export1cName "Export1c"

[Setup]
; NOTE: The value of AppId uniquely identifies this application.
; Do not use the same AppId value in installers for other applications.
; (To generate a new GUID, click Tools | Generate GUID inside the IDE.)
AppId={{51C6F430-E2B3-42FB-A704-43B2CC525D42}
AppName={#AppName}
;AppName={#ModuleName}
;AppVersion={#MajorVersion}.{#MinorVersion}
AppVersion={#versionnumber}
;AppVerName={#MyAppName} {#MyAppVersion}
AppPublisher={#AppPublisher}
AppPublisherURL={#AppURL}
AppSupportURL={#AppURL}
AppUpdatesURL={#UpdateURL}
DefaultDirName=c:\{#AppName}
DefaultGroupName={#AppName}
OutputDir={#workpath}\build\dist
OutputBaseFilename=Setup_{#AppName}_{#versionnumber}.{#buildnumber}
Compression=lzma
SolidCompression=yes

[Languages]
Name: "russian"; MessagesFile: "compiler:Languages\Russian.isl"

[Components]
Name: "Verification"; Description: "Рабочее место испытателя"; Types: full custom
Name: "Manager"; Description: "Рабочее место начальника"; Types: full custom
Name: "Info"; Description: "Анализ результатов испывтаний"; Types: full custom
Name: "Integration"; Description: "Интеграция с 1С"; Types: full custom
Name: "Export1c"; Description: "Выгрузка в 1С"; Types: full custom
Name: "Print"; Description: "ПОддержка печати"; Types: full custom

[Files]
; verification
Source: "{#workpath}\build\dist\wpt\*"; DestDir: "{app}\{#VerificationName}"; Excludes: "config.json,FastReport3.dll,psqlodbc.msi"; Flags: ignoreversion recursesubdirs createallsubdirs; Components: Verification
Source: "{#workpath}\build\dist\wpt\config.json"; DestDir: "{app}\{#VerificationName}"; Flags: ignoreversion onlyifdoesntexist uninsneveruninstall; Components: Verification
;Source: "{#workpath}\build\dist\wpt\psqlodbc.msi"; DestDir: "{tmp}"; Flags: deleteafterinstall; Components: Verification
; Manager
Source: "{#workpath}\build\dist\wpm\*"; DestDir: "{app}\{#ManagerName}"; Excludes: "config.json,FastReport3.dll,psqlodbc.msi"; Flags: ignoreversion recursesubdirs createallsubdirs; Components: Manager
Source: "{#workpath}\build\dist\wpm\config.json"; DestDir: "{app}\{#ManagerName}"; Flags: ignoreversion onlyifdoesntexist uninsneveruninstall; Components: Manager
;Source: "{#workpath}\build\dist\wpm\FastReport3.dll"; DestDir: "{syswow64}"; Flags: onlyifdoesntexist regserver uninsneveruninstall; Components: Manager
; Info
Source: "{#workpath}\build\dist\wpi\*"; DestDir: "{app}\{#InfoName}"; Excludes: "config.json,FastReport3.dll,psqlodbc.msi"; Flags: ignoreversion recursesubdirs createallsubdirs; Components: Info
Source: "{#workpath}\build\dist\wpi\config.json"; DestDir: "{app}\{#InfoName}"; Flags: ignoreversion onlyifdoesntexist uninsneveruninstall; Components: Info
; integration
Source: "{#workpath}\build\dist\integration\integration.exe"; DestDir: "{app}\{#IntegrationName}"; Flags: ignoreversion; Components: Integration
Source: "{#workpath}\build\dist\integration\*"; DestDir: "{app}\{#IntegrationName}"; Flags: ignoreversion recursesubdirs createallsubdirs; Components: Integration
Source: "{#workpath}\unittest\integration.ini"; DestDir: "{app}\{#IntegrationName}"; Flags: ignoreversion onlyifdoesntexist; Components: Integration
; Export1c
Source: "{#workpath}\build\dist\Export1c\Export1c.exe"; DestDir: "{app}\{#Export1cName}"; Flags: ignoreversion; Components: Export1c
Source: "{#workpath}\build\dist\Export1c\*"; DestDir: "{app}\{#Export1cName}"; Flags: ignoreversion recursesubdirs createallsubdirs; Components: Export1c
Source: "{#workpath}\unittest\integration.ini"; DestDir: "{app}\{#Export1cName}"; Flags: ignoreversion onlyifdoesntexist; Components: Export1c
; Print
Source: "{#workpath}\build\dist\wpt\FastReport3.dll"; DestDir: "{syswow64}"; Flags: onlyifdoesntexist regserver uninsneveruninstall; Components: Print
Source: "{#workpath}\build\dist\wpt\psqlodbc.msi"; DestDir: "{tmp}"; Flags: deleteafterinstall; Components: Print

; NOTE: Don't use "Flags: ignoreversion" on any shared system files

[Icons]
; common
Name: "{group}\Uninstall"; Filename: "{uninstallexe}"
Name: "{group}\Downloads"; Filename: "http://diposoft.ru/ElectroLab/install/"
; Verification
Name: "{group}\{#VerificationName}"; Filename: "{app}\{#VerificationName}\{#VerificationExeName}"; Components: Verification
Name: "{commondesktop}\{#VerificationName}"; Filename: "{app}\{#VerificationName}\{#VerificationExeName}"; Components: Verification
Name: "{group}\Config\{#VerificationName}"; Filename: "notepad.exe"; WorkingDir: "{app}\{#VerificationName}"; Parameters: "{app}\{#VerificationName}\config.json"; Components: Verification
; Manager
Name: "{group}\{#ManagerName}"; Filename: "{app}\{#ManagerName}\{#ManagerExeName}"; Components: Manager
Name: "{commondesktop}\{#ManagerName}"; Filename: "{app}\{#ManagerName}\{#ManagerExeName}"; Components: Manager
Name: "{group}\Config\{#ManagerName}"; Filename: "notepad.exe"; WorkingDir: "{app}\{#ManagerName}"; Parameters: "{app}\{#ManagerName}\config.json"; Components: Manager
; Info
Name: "{group}\{#InfoName}"; Filename: "{app}\{#InfoName}\{#InfoExeName}"; Components: Info
Name: "{commondesktop}\{#InfoName}"; Filename: "{app}\{#InfoName}\{#InfoExeName}"; Components: Info
Name: "{group}\Config\{#InfoName}"; Filename: "notepad.exe"; WorkingDir: "{app}\{#InfoName}"; Parameters: "{app}\{#InfoName}\config.json"; Components: Info
; integration
Name: "{group}\Config\{#IntegrationName}"; Filename: "notepad.exe"; WorkingDir: "{app}\{#IntegrationName}"; Parameters: "{app}\{#IntegrationName}\integration.ini"; Components: Integration
; Export1c
Name: "{group}\Config\{#Export1cName}"; Filename: "notepad.exe"; WorkingDir: "{app}\{#Export1cName}"; Parameters: "{app}\{#Export1cName}\integration.ini"; Components: Export1c

[Run]
Filename: "msiexec.exe"; Parameters: "/passive TARGETDIR=""{sys}"" /i ""{tmp}\psqlodbc.msi"""; Components: Info
Filename: "Schtasks"; Parameters: "/Create /tn ""Electrolab Integration"" /tr ""{app}\{#IntegrationName}\{#IntegrationExeName} {app}\{#IntegrationName}\integration.ini"" /SC DAILY /ST 04:00:00"; Components: Integration
Filename: "Schtasks"; Parameters: "/Create /tn ""Electrolab Export"" /tr ""{app}\{#Export1cName}\{#Export1cExeName} {app}\{#Export1cName}\integration.ini"" /SC MINUTE /MO 5"; Components: Export1c

[Registry]
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\ODBC Data Sources; ValueType: string; ValueName: PostgreSQL35W; ValueData: PostgreSQL Unicode; Flags: createvalueifdoesntexist uninsdeletevalue
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Driver; ValueType: string; ValueData: {pf32}\psqlODBC\0900\bin\psqlodbc35w.dll
;Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Driver; ValueType: string; ValueData: {sys}\psqlodbc35w.dll
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: CommLog; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Debug; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Fetch; ValueType: string; ValueData: 100
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Optimizer; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Ksqo; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UniqueIndex; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UseDeclareFetch; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UnknownSizes; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: TextAsLongVarchar; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UnknownsAsLongVarchar; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: BoolsAsChar; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Parse; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: CancelAsFreeStmt; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: MaxVarcharSize; ValueType: string; ValueData: 255
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: MaxLongVarcharSize; ValueType: string; ValueData: 8190
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ExtraSysTablePrefixes; ValueType: string; ValueData: dd_
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Description; ValueType: string; ValueData: electrolab
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Database; ValueType: string; ValueData: electrolab
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Servername; ValueType: string; ValueData: localhost
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Port; ValueType: string; ValueData: 5432
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Username; ValueType: string; ValueData: electrolab
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UID; ValueType: string; ValueData: electrolab
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Password; ValueType: string; ValueData: electrolab
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ReadOnly; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ShowOidColumn; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: FakeOidIndex; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: RowVersioning; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ShowSystemTables; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: Protocol; ValueType: string; ValueData: 7.4
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ConnSettings; ValueType: string; ValueData: 
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: DisallowPremature; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UpdatableCursors; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: LFConversion; ValueType: string; ValueData: 1
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: TrueIsMinus1; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: BI; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: AB; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: ByteaAsLongVarBinary; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: UseServerSidePrepare; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: LowerCaseIdentifier; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: GssAuthUseGSS; ValueType: string; ValueData: 0
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: SSLmode; ValueType: string; ValueData: disable
Root: HKLM; SubKey: Software\ODBC\ODBC.INI\PostgreSQL35W; Flags: createvalueifdoesntexist uninsdeletevalue; ValueName: XaOpt; ValueType: string; ValueData: 1